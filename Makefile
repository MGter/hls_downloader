# ============================================================
# HLS Downloader é¡¹ç›® Makefile
# é¡¹ç›®ç»“æ„: github.com/MGter/hls_downloader
# ============================================================

# å¯æ‰§è¡Œæ–‡ä»¶åç§°
APP_NAME := hls_downloader

# æºç æ‰€åœ¨ç›®å½•ï¼ˆåŒ…å« main.goï¼‰
MAIN_PATH := ./cmd/hls_downloader

# æ„å»ºè¾“å‡ºç›®å½•
BUILD_DIR := ./bin

# Go ç¼–è¯‘å™¨è®¾ç½®
GO := go
GOFLAGS := -ldflags="-s -w"  # å»æ‰ç¬¦å·è¡¨ï¼Œå‡å°äºŒè¿›åˆ¶ä½“ç§¯

# ============================================================
# æ„å»ºç›®æ ‡
# ============================================================

# é»˜è®¤ç›®æ ‡ï¼šæ„å»ºå¯æ‰§è¡Œæ–‡ä»¶
all: build

# ç¼–è¯‘é¡¹ç›®
build:
	@echo "ğŸ”§ Building $(APP_NAME)..."
	@$(GO) build $(GOFLAGS) -o $(BUILD_DIR)/$(APP_NAME) $(MAIN_PATH)
	@echo "âœ… Build complete: $(BUILD_DIR)/$(APP_NAME)"

# ============================================================
# æµ‹è¯•ä¸æ£€æŸ¥
# ============================================================

# è¿è¡Œæ‰€æœ‰å•å…ƒæµ‹è¯•
test:
	@echo "ğŸ§ª Running unit tests..."
	@$(GO) test ./... -v

# ä»£ç æ ¼å¼åŒ–ä¸æ£€æŸ¥
fmt:
	@echo "ğŸ¨ Formatting code..."
	@$(GO) fmt ./...

vet:
	@echo "ğŸ” Running go vet..."
	@$(GO) vet ./...

# ä¸€é”®æ£€æŸ¥ï¼ˆæ ¼å¼ + vetï¼‰
check: fmt vet

# ============================================================
# æ¸…ç†ä¸è¾…åŠ©å‘½ä»¤
# ============================================================

# åˆ é™¤æ„å»ºäº§ç‰©
clean:
	@echo "ğŸ§¹ Cleaning build files..."
	@rm -rf $(BUILD_DIR)

# è‡ªåŠ¨æ•´ç†ä¾èµ–
tidy:
	@echo "ğŸ§­ Running go mod tidy..."
	@$(GO) mod tidy

# ============================================================
# è°ƒè¯•è¿è¡Œ
# ============================================================

# è¿è¡Œç¨‹åºï¼ˆå¯ä¼ å…¥ URL å‚æ•°ï¼‰
run:
	@$(GO) run $(MAIN_PATH) $(ARGS)

# ç¤ºä¾‹ï¼š make run ARGS="https://example.com/playlist.m3u8"

# ============================================================
# ä¼ªç›®æ ‡å£°æ˜ï¼ˆé˜²æ­¢ä¸åŒåæ–‡ä»¶å†²çªï¼‰
# ============================================================
.PHONY: all build test fmt vet check clean tidy run
